import{_ as Se}from"./preload-helper.101896b7.js";import{R as F,c as ie,r as y}from"./index.cb8fb047.js";import{j as r,u as Oe,s as Te,a as Re,b as Q,c as D,E as Ae}from"./EditionDot.abe84bd5.js";import{s as ae,d as Ce}from"./utilities.68e012a2.js";const _=({children:e,node:t})=>{if(t.nodeType===1){const n=t;return F.createElement(n.tagName,{},r.jsxs(r.Fragment,{children:[r.jsx("span",{hidden:!0,"aria-hidden":!0,"data-original":!0,dangerouslySetInnerHTML:{__html:ae(n)}}),e]}))}return r.jsxs(r.Fragment,{children:[r.jsx("span",{hidden:!0,"aria-hidden":!0,"data-original":!0,dangerouslySetInnerHTML:{__html:t.textContent||""}}),e]})};var L={};Object.defineProperty(L,"__esModule",{value:!0});var Pe=y;function $e(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var N=$e(Pe);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?se(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function J(e,t,n){return t&&oe(e.prototype,t),n&&oe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(){return Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Y.apply(this,arguments)}function H(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},M(e)}function Z(e,t){return Z=Object.setPrototypeOf||function(s,o){return s.__proto__=o,s},Z(e,t)}function Ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ee(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ee(e)}function q(e){var t=Ie();return function(){var s=M(e),o;if(t){var l=M(this).constructor;o=Reflect.construct(s,arguments,l)}else o=s.apply(this,arguments);return ke(this,o)}}var le=N.default.createContext(),De=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ie<"u"?ie:typeof self<"u"?self:{},ce={exports:{}};(function(e,t){(function(n,s){e.exports=s()})(De,function(){var n=new function(){var s=this;s.init=function(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.repeat=function(c){return new Array(1+c).join(this)}},s.init();var o=/\/\*[\s\S]*?\*\//g,l=/([^\:]+):([^\;]*);/,f=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gmi,h=1,x=2,E=3,S=4,T=function(c){return typeof c>"u"||c.length==0||c==null};s.toJSON=function(c,m){var a={children:{},attributes:{}},p=null,w=0;if(typeof m>"u")var m={ordered:!1,comments:!1,stripComments:!1,split:!1};for(m.stripComments&&(m.comments=!1,c=c.replace(o,""));(p=f.exec(c))!=null;)if(!T(p[h])&&m.comments){var R=p[h].trim();a[w++]=R}else if(T(p[x]))if(T(p[E])){if(!T(p[S])){var P=p[S].trim(),$=l.exec(P);if($){var b=$[1].trim(),k=$[2].trim();if(m.ordered){var j={};j.name=b,j.value=k,j.type="attr",a[w++]=j}else if(b in a.attributes){var I=a.attributes[b];I instanceof Array||(a.attributes[b]=[I]),a.attributes[b].push(k)}else a.attributes[b]=k}else a[w++]=P}}else return a;else{var b=p[x].trim(),C=s.toJSON(c,m);if(m.ordered){var j={};j.name=b,j.value=C,j.type="rule",a[w++]=j}else{if(m.split)var v=b.split(",");else var v=[b];for(i in v){var u=v[i].trim();if(u in a.children)for(var d in C.attributes)a.children[u].attributes[d]=C.attributes[d];else a.children[u]=C}}}return a},s.toCSS=function(c,m,a){var p="";if(typeof m>"u"&&(m=0),typeof a>"u"&&(a=!1),c.attributes)for(i in c.attributes){var w=c.attributes[i];if(w instanceof Array)for(var R=0;R<w.length;R++)p+=A(i,w[R],m);else p+=A(i,w,m)}if(c.children){var b=!0;for(i in c.children)a&&!b?p+=`
`:b=!1,p+=g(i,c.children[i],m)}return p};var A=function(c,m,a){return"	".repeat(a)+c+": "+m+`;
`},g=function(c,m,a){var p="	".repeat(a)+c+` {
`;return p+=s.toCSS(m,a+1),p+="	".repeat(a)+`}
`,p}};return n})})(ce);var ue=function(e){H(n,e);var t=q(n);function n(){return G(this,n),t.apply(this,arguments)}return J(n,[{key:"render",value:function(){var o=this,l=Array.from(this.props.teiNodes);return l.map(function(f,h){return N.default.createElement(te,{key:"".concat(f.tagName).concat(h),teiNode:f,availableRoutes:o.props.availableRoutes})})}}]),n}(N.default.Component),te=function(e){H(n,e);var t=q(n);function n(){return G(this,n),t.apply(this,arguments)}return J(n,[{key:"forwardTeiAttributes",value:function(){return Array.from(this.props.teiNode.attributes).reduce(function(o,l){switch(l.name){case"ref":o.Ref=l.value;break;case"style":o.style=ce.exports.toJSON(l.value);break;default:o[l.name]=l.value}return o},{})}},{key:"render",value:function(){var o=this;if(!this.props.teiNode)return null;var l,f;if(this.props.teiNode.nodeType===3)if(this.props.availableRoutes.includes("text()"))l="text()";else return this.props.teiNode.nodeValue;else if(this.props.teiNode.nodeType===1){var h=this.props.teiNode,x=h.tagName.toLowerCase();if(f=N.default.createElement(ue,Y({teiNodes:h.childNodes},this.props)),this.props.availableRoutes.includes(x))l=x;else return N.default.createElement(x,K({},this.forwardTeiAttributes()),f)}else return null;return N.default.createElement(le.Consumer,null,function(E){var S=E[l];return N.default.isValidElement(S)?N.default.cloneElement(S,K({},o.props),f):N.default.createElement(S,K({},o.props),f)})}}]),n}(N.default.Component),Le=function(e){H(n,e);var t=q(n);function n(){return G(this,n),t.apply(this,arguments)}return J(n,[{key:"componentDidMount",value:function(){this.props.children&&this.props.component}},{key:"render",value:function(){return null}}]),n}(N.default.Component),Me=function(e){H(n,e);var t=q(n);function n(s){var o;return G(this,n),o=t.call(this,s),W(ee(o),"availableRoutes",[]),W(ee(o),"routes",{}),N.default.Children.forEach(s.children,function(l){o.availableRoutes.push(l.props.el),l.props.children?o.routes[l.props.el]=l.props.children:o.routes[l.props.el]=l.props.component}),o}return J(n,[{key:"render",value:function(){return this.props.data?N.default.createElement(le.Provider,{value:this.routes},N.default.createElement(te,{teiNode:this.props.data,availableRoutes:this.availableRoutes})):null}}]),n}(N.default.Component),de=L.TEINode=te,O=L.TEINodes=ue,Be=L.TEIRender=Me,Ve=L.TEIRoute=Le;const z=e=>Array.from(e).reduce((t,n)=>(t[n.name==="ref"?"Ref":n.name]=n.value,t),{}),U=e=>{if(e.teiNode.nodeType===1){const t=e.teiNode;return F.createElement(t.localName,{...z(t.attributes)},r.jsx(O,{teiNodes:t.childNodes,availableRoutes:e.availableRoutes}))}return r.jsx(de,{...e})},fe=e=>{let t=ae(e.teiNode,!0),n=t.match(/^[\t ]+/);return n&&(t=t.replace(new RegExp("^"+n[0],"mg"),"")),r.jsx(_,{node:e.teiNode,children:r.jsx("pre",{children:t})})},pe=e=>{const t=e.teiNode,n=t.getAttribute("url");if(!n)return null;const s={src:n};return t.getAttribute("width")&&(s.width=t.getAttribute("width")||""),t.getAttribute("height")&&(s.height=t.getAttribute("width")||""),r.jsx(_,{node:e.teiNode,children:r.jsx("img",{...s})})},he=e=>{const t=e.teiNode;if(t.getAttribute("type")!=="gloss")return r.jsx(U,{...e});const n=Array.from(t.childNodes);return r.jsx(_,{node:e.teiNode,children:r.jsx("dl",{children:n.map((s,o)=>{if(s.nodeType!==1)return r.jsx(de,{teiNode:s,availableRoutes:e.availableRoutes},`t-${o}`);const l=s;switch(l.localName){case"tei-label":return r.jsx("dt",{children:r.jsx(O,{teiNodes:l.childNodes,...e})},`tt-${o}`);case"tei-item":return r.jsx("dd",{children:r.jsx(O,{teiNodes:l.childNodes,...e})},`td-${o}`)}})})})},me=e=>{const t=e.teiNode;if(t.getAttribute("place")!=="end")return r.jsx(U,{...e});const n=`_note_${t.getAttribute("data-idx")}`;return r.jsx(_,{node:e.teiNode,children:r.jsx("sup",{children:r.jsx("a",{id:`src${n}`,href:`#${n}`,children:t.getAttribute("data-idx")})})})},ge=e=>{const n=e.teiNode.getAttribute("target")||"";return r.jsx(_,{node:e.teiNode,children:r.jsx("a",{href:n,children:n})})},ve=e=>{const t=e.teiNode,n=t.getAttribute("target")||"";return r.jsx(_,{node:e.teiNode,children:r.jsx("a",{href:n,children:r.jsx(O,{teiNodes:t.childNodes,...e})})})},xe=e=>{const t=e.teiNode,n=[],s=[],o=Array.from(t.getElementsByTagName("tei-note")).reduce((f,h,x)=>{if(h.getAttribute("place")==="end"){h.setAttribute("data-idx",(x+1).toString());const E=`_note_${x+1}`;f.push(r.jsx("li",{id:E,children:r.jsx(O,{teiNodes:h.childNodes,...e},`en${x}`)},E))}return f},[]);o.length>0&&s.push(r.jsx("ol",{className:"ceteicean-notes",children:o},`endnotes-${s.length}`));const l=F.createElement("tei-tei",{...z(t.attributes)},r.jsx(O,{teiNodes:e.teiNode.childNodes,...e}));return r.jsxs(r.Fragment,{children:[n,l,s]})},be=e=>{const t=e.teiNode;return F.createElement(t.localName.toLowerCase(),{...z(t.attributes)},r.jsx(_,{node:e.teiNode}))},je=Object.freeze(Object.defineProperty({__proto__:null,Eg:fe,Graphic:pe,List:he,Note:me,Ptr:ge,Ref:ve,SafeUnchangedNode:U,Tei:xe,TeiHeader:be,forwardAttributes:z},Symbol.toStringTag,{value:"Module"}));function Ne({doc:e,elements:t,routes:n}){y.useEffect(()=>{for(const f of t)Ce(f)});const o=n||{"tei-tei":xe,"teieg-egxml":fe,"tei-graphic":pe,"tei-list":he,"tei-note":me,"tei-ptr":ge,"tei-ref":ve,"tei-teiheader":be},l=Object.keys(o).map((f,h)=>r.jsx(Ve,{el:f,component:o[f]},`tr-${h}`));return r.jsx(Be,{data:e.documentElement,children:l})}const ne=y.createContext({variant:null,setVariant:()=>console.warn("no variant data provider")}),re=y.createContext({seg:null,setSeg:()=>console.warn("no seg id provider")}),Fe=e=>{const t=Oe(Te),{setVariant:n}=y.useContext(ne),{seg:s,setSeg:o}=y.useContext(re),l=e.teiNode,f=l.getAttribute("xml:id"),h=f?.substring(0,3),E=`https://raw.githubusercontent.com/FrankensteinVariorum/fv-data/master/2023-variorum-chapters/f${e.source}_${e.unit}.xml#${f}`,[S,T]=y.useState(""),[A,g]=y.useState(""),c=e.spine.documentElement.querySelector(`ptr[target="${E}"]`);if(y.useEffect(()=>{const a=c?c.closest("app").getAttribute("n"):void 0,p=a?parseInt(a):void 0,w=p&&p<10?1:p&&p<30?2:3;T(`app-intensity-${w}`);const R=window.location.hash.substring(1);o({id:R}),l.getAttribute("xml:id").replace(/-.*/,"")==R?g(`seg_bg--${e.source.toLowerCase()}`):g("")},[]),!c)return r.jsx(U,{...e});const m=async a=>{const w=c.closest("app").querySelectorAll("rdgGrp"),b=await(async()=>{const u=[];for(const d of Array.from(w)){const P=d.getAttribute("n"),$=P?JSON.parse(P.replace(/'(?:(?!',)[^'])*'/g,X=>X.replace(/"/g,'\\"')).replace(/'(?=(?:[^"]*"[^"]*")*[^"]*$)/g,'"').replace(/'([^']+?)'([,\]])/g,'"$1"$2').replace(/\['/g,'["').replace(/',/g,'",').replace(/, '/g,', "').replace(/\\"(, ")/g,'"$1')).join(" "):"",k=d.querySelectorAll("rdg");let I=[];for(const X of k){const Ee=X.getAttribute("wit")||"";I.push(Ee.replace("#f","")||"")}I.length>0&&u.push({sources:I,value:$})}return u})();n({readings:b});const C=(u,d)=>{const P=document.getElementsByClassName(u);Array.from(P).forEach($=>$.classList.toggle(`seg_bg--${e.source.toLowerCase()}`,d))};s?.id&&C(s?.id,!1);let j=a.target.closest("span[class*='app']").className.split(" ")[0].replace(/-.*/,"");o({id:j}),C(j,!0);const v=j?.split("app")[1];Re.set(v),console.log("app:",v,"chunk:",j.substring(0,3)),Q.set({edition:e.source,chunk:j.substring(0,3),f1818Chp:D.find(u=>u.label==="1818").units.find(u=>u.chunks.find(d=>d.label==h&&d.apps[0]<=v&&v<=d.apps[1]+1)).id,f1823Chp:D.find(u=>u.label==="1823").units.find(u=>u.chunks.find(d=>d.label==h&&d.apps[0]<=v&&v<=d.apps[1]+1)).id,f1831Chp:D.find(u=>u.label==="1831").units.find(u=>u.chunks.find(d=>d.label==h&&d.apps[0]<=v&&v<=d.apps[1]+1)).id,fThomasChp:D.find(u=>u.label==="Thomas").units.find(u=>u.chunks.find(d=>d.label==h&&d.apps[0]<=v&&v<=d.apps[1]+1)).id,fMSChp:D.find(u=>u.label==="MS").units.find(u=>u.chunks.find(d=>d.label==h&&d.apps[0]<=v&&v<=d.apps[1]+1))?.id||""}),console.log(Q.get())};return r.jsx(_,{node:e.teiNode,children:r.jsx("span",{id:f.replace(/-.*/,""),className:t.showVariants?`${f.replace(/-.*/,"")} ${S} ${A}`:"",style:{cursor:"pointer"},onClick:m,children:r.jsx(O,{teiNodes:l.childNodes,...e})})})},B=e=>{const t=e.teiNode;return r.jsx(_,{node:e.teiNode,children:r.jsx("del",{children:r.jsx(O,{teiNodes:t.childNodes,...e})})})},ye=e=>{const t=e.teiNode;return r.jsx(_,{node:e.teiNode,children:r.jsx("span",{className:"unclear",children:r.jsx(O,{teiNodes:t.childNodes,...e})})})},we=e=>(e.teiNode,r.jsxs(_,{node:e.teiNode,children:[r.jsx("span",{className:"paragraph-break",children:"¶"}),r.jsx("span",{className:"paragraph-break-reading-panel",children:r.jsx("br",{})})]})),_e=e=>{const t=e.teiNode;return r.jsx(_,{node:e.teiNode,children:r.jsxs("ins",{children:[r.jsx("span",{className:"insertion",children:"^"}),r.jsx(O,{teiNodes:t.childNodes,...e})]})})};function Ge({doc:e,data:t,elements:n}){const{Tei:s,Eg:o,Graphic:l,List:f,Note:h,Ptr:x,Ref:E,TeiHeader:S}=je,T={"tei-tei":s,tei:s,"tei-egxml":o,"tei-graphic":l,"tei-list":f,"tei-note":h,"tei-ptr":x,"tei-ref":E,"tei-teiheader":S,"tei-add":g=>r.jsx(_e,{...g}),"tei-del":g=>r.jsx(B,{...g}),mdel:g=>r.jsx(B,{...g}),unclear:g=>r.jsx(ye,{...g}),"p-end":g=>r.jsx(we,{...g})},A=typeof DOMParser<"u"?new DOMParser().parseFromString(t,"text/xml"):e;return r.jsx(Ne,{doc:A,elements:n,routes:T})}const Je=({group:e})=>{e.sources.map(s=>r.jsx(Ae,{small:!0,edition:s},s));const{seg:t}=y.useContext(re);let n=`<?xml version="1.0" encoding="UTF-8"?><TEI xmlns="http://www.tei-c.org/ns/1.0">${e.value}</TEI>`;return r.jsxs("div",{className:"reading-group",children:[r.jsx("div",{className:"reading-group-title",children:e.sources.map(s=>e.value!=""?r.jsxs("a",{className:`clr--${s.toLowerCase()}`,href:`../${s}/${Q.get()[`f${s}Chp`]}#${t?.id}`,children:[s,", "]}):r.jsxs("a",{className:`clr--${s.toLowerCase()}`,children:[s,", "]}))}),r.jsx("div",{className:"reading-group-content",children:e.value!==""?r.jsx(Ge,{doc:null,data:n,elements:["del","p","add","mdel","unclear","note"]}):r.jsx("div",{className:"empty-group",children:"∅"})})]})},He=({source:e})=>{const{variant:t}=y.useContext(ne);return t?r.jsxs("div",{className:"app-list",children:[r.jsx("hr",{className:"app-list-to-divider"}),t.readings.map(n=>r.jsx(Je,{group:n}))]}):null},qe=()=>(y.useEffect(()=>{const t=window.location.hash.substring(1);console.log("seg id:",t);const n=document.getElementById(t);n&&n.click()},[]),null),ze=e=>{const t=e.teiNode,n=t.getAttribute("resp");return r.jsx(_,{node:e.teiNode,children:r.jsxs("span",{className:"note",children:[n?r.jsxs("span",{className:"resp",children:[n,": "]}):null,r.jsx(O,{teiNodes:t.childNodes,...e})]})})};let V;if(typeof DOMParser<"u")V=e=>new DOMParser().parseFromString(e,"text/xml");else{const{JSDOM:e}=await Se(()=>import("./api.287f3e68.js").then(t=>t.a),["_astro/api.287f3e68.js","_astro/index.cb8fb047.js"]);V=t=>new e(t,{contentType:"text/xml"}).window.document}function We({data:e,elements:t,spine:n,source:s,unit:o}){const[l,f]=y.useState(),[h,x]=y.useState(),{Tei:E,Ptr:S,Ref:T,TeiHeader:A}=je,g=V(n),c={"tei-tei":E,"tei-ptr":S,"tei-ref":T,"tei-teiheader":A,"tei-seg":a=>r.jsx(Fe,{source:s,spine:g,unit:o,...a}),"tei-del":a=>r.jsx(B,{...a}),mdel:a=>r.jsx(B,{...a}),unclear:a=>r.jsx(ye,{...a}),"tei-p-end":a=>r.jsx(we,{...a}),"tei-add":a=>r.jsx(_e,{...a}),"tei-note":a=>r.jsx(ze,{...a})},m=V(e);return r.jsxs(re.Provider,{value:{seg:h,setSeg:x},children:[r.jsx(qe,{}),r.jsxs(ne.Provider,{value:{variant:l,setVariant:f},children:[r.jsx("aside",{id:"viewer__marginalia"}),r.jsx(Ne,{doc:m,elements:t,routes:c}),r.jsx("aside",{id:"viewer_variations",children:r.jsx(He,{source:s})})]})]})}export{We as default};
